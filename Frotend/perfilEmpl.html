<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Perfil</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/css/Bienvenido.css">
    <link rel="stylesheet" href="/css/Vistas.css">
    <link rel="stylesheet" href="/css/perfilEmpl.css">
    <link rel="stylesheet" href="/css/spinner.css">
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="../js/validacion.js" type="module"></script>
</head>

<body>
    <!-- Sidebars -->
    <div id="sidebar-admin" class="sidebar" style="display: none;">
        <div class="menu-item">
            <a href="../Frotend/BienvenidoAdm.html">
                <img src="/Images/inicioEmple.png" alt="Inicio">
            </a>
            <span>Inicio</span>
        </div>
        <div class="menu-item">
            <a href="../Frotend/Vistainventarioadmin.html">
                <img src="/Images/invenEmple.png" alt="Inventario">
            </a>
            <span>Inventario</span>
        </div>
        <div class="menu-item">
            <a href="../Frotend/HistorialVentas.html">
                <img src="/Images/ventasEmple.png" alt="Ventas">
            </a>
            <span>Ventas</span>
        </div>
        <div class="menu-item">
            <a href="../Frotend/HistorialPedidos.html">
                <img src="../Images/pedidosEmple.png" alt="Pedidos">
            </a>
            <span>Pedidos</span>
        </div>
        <div class="menu-item">
            <a href="../Frotend/Historialventaypedidos.html">
                <img src="../Images/historicoEmple.png" alt="Histórico">
            </a>
            <span>Histórico</span>
        </div>
        <div class="menu-item">
            <a href="../Frotend/Notificaciones.html">
                <img src="/Images/notiEmple.png" alt="Notificaciones">
            </a>
            <span>Notificaciones</span>
        </div>
        <div class="menu-item">
            <a href="../Frotend/empleados.html">
                <img src="/Images/colabEmple.png" alt="Colaboradores">
            </a>
            <span>Colaboradores</span>
        </div>
        <div class="menu-item">
            <a href="../Frotend/perfilEmpl.html">
                <img src="/Images/personas.png" alt="pefil">
            </a>
            <span>Perfil</span>
        </div>
        <div class="menu-item" id="cerrarSesionAdmin">
            <a href="#">
                <img src="/Images/exitEmple.png" alt="Cerrar sesión">
            </a>
            <span>Cerrar sesión</span>
        </div>
    </div>

    <!--NAVBAR DE AUXILIAR-->
    <div id="sidebar-auxiliar" class="sidebar" style="display: none;">
        <div class="menu-item">
            <a href="../Frotend/BienvenidoAUX.html">
                <img src="../Images/inicioEmple.png" alt="Inicio">
            </a>
            <span>Inicio</span>
        </div>
        <div class="menu-item">
            <a href="../Frotend/Vistainventarioauxiliar.html">
                <img src="../Images/invenEmple.png" alt="Inventario">
            </a>
            <span>Inventario</span>
        </div>
        <div class="menu-item">
            <a href="../Frotend/VentasAux.html">
                <img src="../Images/ventasEmple.png" alt="Ventas">
            </a>
            <span>Ventas</span>
        </div>
        <div class="menu-item">
            <a href="../Frotend/CitasAux.html">
                <img src="../Images/pedidosEmple.png" alt="Citas">
            </a>
            <span>Citas</span>
        </div>
        <div class="menu-item">
            <a href="#">
                <img src="../Images/notiEmple.png" alt="Notificaciones">
            </a>
            <span>Notificaciones</span>
        </div>
        <div class="menu-item">
            <a href="../Frotend/perfilEmpl.html">
                <img src="/Images/personas.png" alt="pefil">
            </a>
            <span>Perfil</span>
        </div>
        <div class="menu-item" id="cerrarSesion">
            <a href="#">
                <img src="../Images/exitEmple.png" alt="Cerrar sesión">
            </a>
            <span>Cerrar sesión</span>
        </div>
    </div>
    <!--NAVBAR MECANICO -->
    <div id="sidebar-mecanico" class="sidebar" style="display: none;">
        <div class="menu-item">
            <a href="../Frotend/Vistainventariomecanico.html">
                <img src="../Images/invenEmple.png" alt="Inventario"></a>
            <span>Inventario</span>
        </div>
        <div class="menu-item">
            <img src="../Images/pedidosEmple.png" alt="Citas">
            <span>Citas</span>
        </div>
        <div class="menu-item">
            <img src="../Images/notiEmple.png" alt="Notificaciones">
            <span>Notificaciones</span>
        </div>

        <div class="menu-item">
            <a href="../Frotend/perfilEmpl.html">
                <img src="/Images/personas.png" alt="pefil">
            </a>
            <span>Perfil</span>
        </div>
        <div class="menu-item" id="cerrarSesionMecanico">
            <a href="#">
                <img src="/Images/exitEmple.png" alt="Cerrar sesión">
            </a>
            <span>Cerrar sesión</span>
        </div>
    </div>

    <!-- Main content -->
    <div class="main-content">
        <div class="container">
            <div class="row justify-content-center">
                <!-- Columna 1: Icono de usuario y correo -->
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <div class="d-flex align-items-center mb-3">
                                <svg class="bi bi-person-fill text-primary mr-3" width="4em" height="4em"
                                    viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
                                    <path fill-rule="evenodd"
                                        d="M8 0a8 8 0 0 0-8 8c0 4.418 3.582 8 8 8s8-3.582 8-8a8 8 0 0 0-8-8zm0 3a3 3 0 1 0 0 6 3 3 0 0 0 0-6zm0 1a2 2 0 1 0 0 4 2 2 0 0 0 0-4z" />
                                </svg>
                                <div>
                                    <h3 class="h4 font-weight-bold mb-0" id="userName">John Doe</h3>
                                    <p class="text-muted mb-0" id="userEmail">john.doe@example.com</p>
                                </div>
                            </div>
                            <button class="btn btn-outline-primary btn-block" data-toggle="modal"
                                data-target="#editProfileModal">Editar Perfil</button>
                        </div>
                    </div>
                </div>

                <!-- Columna 2: Información personal -->
                <div class="col-md-6 mb-4">
                    <div class="card">
                        <div class="card-body">
                            <h3 class="h5 font-weight-bold mb-4">Información Personal</h3>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">Nombre</span>
                                </div>
                                <input type="text" class="form-control" id="userNameInput" readonly value="John Doe">
                            </div>
                            <div class="input-group mb-3">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">Email</span>
                                </div>
                                <input type="email" class="form-control" id="userEmailInput" readonly
                                    value="john.doe@example.com">
                            </div>
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">N° celular</span>
                                </div>
                                <input type="text" class="form-control" id="userPhoneInput" readonly
                                    value="+1 (555) 555-5555">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Botones -->
            <div class="row justify-content-left">
                <div class="col-md-6 text-center">
                    <button class="btn btn-outline-primary mr-2" id="changePasswordBtn" data-toggle="modal"
                        data-target="#changePasswordModal">Cambiar Contraseña</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Editar Perfil -->
    <div class="modal fade" id="editProfileModal" tabindex="-1" role="dialog" aria-labelledby="editProfileModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="editProfileModalLabel">Editar Perfil</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="editProfileForm">
                        <div class="form-group">
                            <label for="editUserName">Nombre</label>
                            <input type="text" class="form-control" id="editUserName" name="nombre" required>
                        </div>
                        <div class="form-group">
                            <label for="editUserEmail">Email</label>
                            <input type="email" class="form-control" id="editUserEmail" name="email" required>
                        </div>
                        <div class="form-group">
                            <label for="editUserPhone">Teléfono</label>
                            <input type="text" class="form-control" id="editUserPhone" name="telefono" required>
                        </div>
                        <div class="form-group">
                            <label for="editUserCedula">Cédula</label>
                            <input type="text" class="form-control" id="editUserCedula" name="cedula" required>
                        </div>
                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Cambio de Contraseña -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1" role="dialog"
        aria-labelledby="changePasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="changePasswordModalLabel">Cambiar Contraseña</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <!-- Campo de contraseña actual -->
                        <div class="form-group">
                            <label for="currentPassword">Contraseña actual</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="currentPassword" name="currentPassword"
                                    placeholder="Ingrese su contraseña actual" required>
                                <img src="../Images/ojo.png" alt="Mostrar/Ocultar contraseña" class="eye-icon"
                                    onclick="togglePassword('currentPassword')">
                            </div>
                        </div>

                        <!-- Campo de nueva contraseña -->
                        <div class="form-group">
                            <label for="newPassword">Nueva contraseña</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="newPassword" name="newPassword"
                                    placeholder="Ingrese su nueva contraseña" required>
                                <img src="../Images/ojo.png" alt="Mostrar/Ocultar contraseña" class="eye-icon"
                                    onclick="togglePassword('newPassword')">
                            </div>
                        </div>

                        <!-- Campo de confirmación de contraseña -->
                        <div class="form-group">
                            <label for="confirmPassword">Confirmar contraseña</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="confirmPassword" name="confirmPassword"
                                    placeholder="Confirme su nueva contraseña" required>
                                <img src="../Images/ojo.png" alt="Mostrar/Ocultar contraseña" class="eye-icon"
                                    onclick="togglePassword('confirmPassword')">
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary">Cambiar</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const rol = localStorage.getItem("idRole");
            console.log("Rol obtenido del localStorage: " + rol);

            // Mostrar el sidebar correspondiente según el rol
            if (rol === "1") {
                document.getElementById("sidebar-admin").style.display = "flex";
                initializeSidebarEvents('cerrarSesionAdmin');
            } else if (rol === "2") {
                document.getElementById("sidebar-auxiliar").style.display = "flex";
                initializeSidebarEvents('cerrarSesionAuxiliar');
            } else if (rol === "3") {
                document.getElementById("sidebar-mecanico").style.display = "flex";
                initializeSidebarEvents('cerrarSesionMecanico');
            }
        });

        function initializeSidebarEvents(cerrarSesionId) {
            const cerrarSesionBtn = document.getElementById(cerrarSesionId);
            if (cerrarSesionBtn) {
                cerrarSesionBtn.addEventListener('click', cerrarSesion);
            }
        }

        // Function to log out the user
        function cerrarSesion() {
            mostrarLoader(); // Show loader before logout process

            // Remove tokens from localStorage
            localStorage.removeItem('accessToken');
            localStorage.removeItem('idRole');
            localStorage.removeItem('nombre');
            localStorage.removeItem('correo');
            localStorage.removeItem('cedula');
            localStorage.removeItem('telefono');

            // Redirect to login page after a delay
            setTimeout(() => {
                ocultarLoader(); // Hide loader after logout process
                redireccionar('../Frotend/loginMRM.html'); // Adjust path if necessary
            }, 1000); // Adjust delay time as needed
        }

        // Function to redirect to a specific URL
        function redireccionar(url) {
            window.location.href = url;
        }

        // Functions to show and hide the loader
        function mostrarLoader() {
            eliminarLoaderPrevio(); // Elimina cualquier loader previo antes de mostrar uno nuevo

            const loader = document.createElement('div');
            loader.id = 'loader';
            loader.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(255, 255, 255, 0.8); display: flex; align-items: center; justify-content: center; z-index: 1000;';
            loader.innerHTML = '<div class="spinner"></div>';
            document.body.appendChild(loader);
        }

        function ocultarLoader() {
            const loader = document.getElementById('loader');
            if (loader) {
                loader.remove(); // Elimina el loader si existe
            }
        }

        function eliminarLoaderPrevio() {
            const loaderPrevio = document.getElementById('loader');
            if (loaderPrevio) {
                loaderPrevio.remove(); // Elimina cualquier loader previo
            }

            // Función para cargar los datos del usuario en el modal de editar perfil
            function cargarDatosUsuarioEnModal() {
                const nombre = localStorage.getItem('nombre');
                const correo = localStorage.getItem('correo');
                const telefono = localStorage.getItem('telefono');

                document.getElementById('userNameInput').value = nombre;
                document.getElementById('userEmailInput').value = correo;
                document.getElementById('userPhoneInput').value = telefono;
            }

            // Escuchar evento para cargar los datos del usuario al abrir el modal de editar perfil
            $('#editarPerfilModal').on('show.bs.modal', function (event) {
                cargarDatosUsuarioEnModal();
            });
        }
    </script>
    <script src="../js/password.js"></script>
    <script src="../js/editProfile.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

</body>

</html>